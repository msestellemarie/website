<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
      Estelle Corey/posts/blog-cd-1/
    </title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="all,follow" />
    <meta name="googlebot" content="index,follow,snippet,archive" />
    <link rel="stylesheet" href="https://estellecorey.com/hugo-theme-console/css/terminal-0.7.4.min.css"> <link
    rel="stylesheet" href="https://estellecorey.com/hugo-theme-console/css/animate-4.1.1.min.css"> <link rel="stylesheet" href="https://estellecorey.com/hugo-theme-console/css/console.css"> 
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="icon" href="/logo.svg" />
<meta property="og:title" content="Setting Up Continuous Deployment for this Blog" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://estellecorey.com/posts/blog-cd-1/" /><meta property="article:published_time" content="2025-01-16T00:00:00+00:00" />



<meta name="twitter:title" content="Setting Up Continuous Deployment for this Blog"/>
<meta name="twitter:description" content="When I first start building infrastructure on AWS, I prefer to manually create everything first. It helps me to sort out the pieces in my brain and also reduces errors once I move to CloudFormation templates.
Today, I&rsquo;m creating the initial infrastructure setup for this blog. Eventually, I want this to be much more automated. My vision is to have a CloudFormation template that creates the CodePipeline and any necessary infrastructure. The CodePipeline will trigger on a push to main in my Github repo. Then it will build the Hugo project and spit out the public folder into an s3 bucket."/>

</head>
  <body class="terminal">
    <div class="container">
      <div class="terminal-nav">
        <header class="terminal-logo">
          <div class="logo terminal-prompt">
             
            <a
              href="https://estellecorey.com/"
              class="no-style "
              >Estelle Corey</a
            >:~# <a
              href='https://estellecorey.com/posts'
              >posts</a
            >/<a
              href='https://estellecorey.com/posts/blog-cd-1'
              >blog-cd-1</a
            >/
          </div>
        </header>
      </div>
    </div>

    <div class="container animated zoomIn fast">
      
<h1>Setting Up Continuous Deployment for this Blog</h1>

Jan. 16, 2025


<br/><br/>
<p>When I first start building infrastructure on AWS, I prefer to manually create everything first. It helps me to sort out the pieces in my brain and also reduces errors once I move to CloudFormation templates.</p>
<p>Today, I&rsquo;m creating the initial infrastructure setup for this blog. Eventually, I want this to be much more automated. My vision is to have a CloudFormation template that creates the CodePipeline and any necessary infrastructure. The CodePipeline will trigger on a push to <code>main</code> in my Github repo. Then it will build the Hugo project and spit out the <code>public</code> folder into an s3 bucket.</p>
<p>For now, I&rsquo;m going to manually create the CodePipeline in the AWS UI without any build step. My process is going to look like this: write a new post, build locally, and
push to <code>main</code>. The CodePipeline will then run automatically and output the content to s3.</p>
<p>I&rsquo;ll need to create a few things in AWS to get this setup working:</p>
<ul>
<li>An s3 bucket to host my static website</li>
<li>A Github connection for the CodePipeline</li>
<li>The CodePipeline itself</li>
</ul>
<h2 id="s3-bucket">S3 Bucket</h2>
<p>First, I head to s3 and create a new bucket. I leave mostly everything default, but I do need to uncheck &ldquo;Block All Public Access&rdquo; to allow people to access it. I go into the newly created bucket and head over to properties and turn on &ldquo;Static website hosting&rdquo; with the index document as <code>index.html</code>. This will be the entrypoint for my blog, so I need to make sure there&rsquo;s an <code>index.html</code> in the root of my Github repo.</p>
<pre tabindex="0"><code>{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
    	{
        	&#34;Sid&#34;: &#34;PublicReadGetObject&#34;,
        	&#34;Effect&#34;: &#34;Allow&#34;,
        	&#34;Principal&#34;: &#34;*&#34;,
        	&#34;Action&#34;: [
            	&#34;s3:GetObject&#34;
        	],
        	&#34;Resource&#34;: [
                &#34;arn:aws:s3:::${Bucket-Name}/*&#34;
        	]
    	}
    ]
}
</code></pre><p>The last piece is setting up the bucket policy under the &ldquo;Permissions&rdquo; section of the bucket. I allow <code>s3:GetObject</code> access for all (<code>*</code>) on my specific bucket (<code>${Bucket-Name}</code>). This will ensure the files that make up my blog are accesible to anyone viewing my site.</p>
<h2 id="github-connection">Github Connection</h2>
<p>The next step is to create the Github connection for the CodePipeline to use. I head over to CodePipeline, then settings, connections, and select &ldquo;Create Connection&rdquo;. I select &ldquo;Github&rdquo; as the provider and name it to match my Github account. Then I hit &ldquo;Connect to Github&rdquo; and &ldquo;Install a new app&rdquo;. From there, I select my Github account and repos to allow access to. Once I&rsquo;m done, I select &ldquo;Install &amp; Authorize&rdquo;. After I return to AWS, I select &ldquo;Connect&rdquo;. Now that my Github connection is ready to use, I can create the CodePipeline.</p>
<h2 id="codepipeline">CodePipeline</h2>
<p>I go to CodePipeline and select &ldquo;Create pipeline&rdquo; and then &ldquo;Build custom pipeline&rdquo;. I name my pipeline, leaving all other settings default and then select &ldquo;Next&rdquo;. From here, the first step is to setup the Source to be my blog&rsquo;s Github repo. I select Github (via Github App) as my source provider and then select the connection I just created, my website repo, and the default branch of <code>main</code>. I leave everything else as default and then select &ldquo;Next&rdquo;. I hit &ldquo;Skip build stage&rdquo; and then &ldquo;Skip test stage&rdquo;. From there I select &ldquo;S3&rdquo; as my deploy provider, select my bucket I created, and then check the &ldquo;Extract file before deploy&rdquo; setting. Then I hit &ldquo;Next&rdquo; and &ldquo;Create Pipeline&rdquo;.</p>
<h2 id="testing">Testing</h2>
<p>From here the CodePipeline automatically runs and uploads my website to the bucket. I go to my S3 bucket and find &ldquo;Static website hosting&rdquo; under &ldquo;Properties&rdquo; and get my &ldquo;Bucket website endpoint&rdquo;. This is where my website is being hosted. After everything looks good at that URL, I test a push to <code>main</code> in my Github repo and I can see the pipeline running and updating. Success!</p>
<h2 id="almost-there">Almost There</h2>
<p>Now that everything&rsquo;s working, I want my blog to use my custom domain and I would like it to use https. The one downside about the static hosting feature on s3 is that it doesn&rsquo;t support https. In order to do this, I need to create a certificate in Certificate Manager and then create a Cloudfront distribution with my s3 bucket as the origin.</p>
<p>I request a certificate from Certificate Manager for my domain using DNS validation. Then I add the CNAME record into my DNS to validate that I own the domain. Once that all clears, I&rsquo;m ready to create my Cloudfront distribution. I set the &ldquo;Origin Domain&rdquo; to my s3 bucket, making sure to use the website endpoint I tested with earlier. I update the &ldquo;Alternate domain name (CNAME)&rdquo; to my domain and then select the ACM certificate that I just created from the list under &ldquo;Custom SSL certificate&rdquo;. I set the caching policy to &ldquo;CachingDisabled&rdquo; and select &ldquo;Redirect HTTP to HTTPS&rdquo; for protocol policy. This ensures that any changes to the repo are immediately displayed on my site. I leave everything else as default and select &ldquo;Create distribution&rdquo;.</p>
<p>After about 10-20 minutes, my distribution is deployed and I can now access my blog using my custom domain. All done for today!</p>


 

    </div>
  </body>
</html>
